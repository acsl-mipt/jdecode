<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Предметно-ориентированный язык описания бортовых интерфейсов Decode</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <!-- decode file CSS -->
    <style type="text/css">
        .ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
        .s0 { color: rgb(204,120,50); font-weight: bold; }
        .s1 { color: rgb(169,183,198); }
        .s2 { color: rgb(106,135,89); }
        .s3 { color: rgb(104,151,187); }
        .s4 { color: rgb(204,120,50); }
    </style>

    <style type="text/css">
        body {
            counter-reset: h2counter;
            counter-reset: h3counter;
            counter-reset: h4counter;
            counter-reset: h5counter;
            counter-reset: h6counter;
        }
        h1 {
            counter-reset: h2counter;
        }
        h2 {
            counter-reset: h3counter;
        }
        h3 {
            counter-reset: h4counter;
        }
        h4 {
            counter-reset: h5counter;
        }
        h5 {
            counter-reset: h6counter;
        }
        h2:before {
            content: counter(h2counter) " ";
            counter-increment: h2counter;
            counter-reset: h3counter;
            font-size: 65%;
            font-weight:400;
            line-height:1;
            color:#777
        }
        h3:before {
            content: counter(h2counter) "." counter(h3counter) " ";
            counter-increment: h3counter;
            font-size: 65%;
            font-weight:400;
            line-height:1;
            color:#777
        }
        h4:before {
            content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) " ";
            counter-increment: h4counter;
            font-size: 65%;
            font-weight:400;
            line-height:1;
            color:#777
        }
        h5:before {
            content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) "." counter(h5counter) " ";
            counter-increment: h5counter;
            font-size: 65%;
            font-weight:400;
            line-height:1;
            color:#777
        }
        h6:before {
            content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) "." counter(h5counter) "." counter(h6counter) " ";
            counter-increment: h6counter;
            font-size: 65%;
            font-weight:400;
            line-height:1;
            color:#777
        }
    </style>
</head>
<body>

<div class="container">

<h1>Предметно-ориентированный язык описания бортовых интерфейсов Decode</h1>
<div>
    <p>Предметно-ориентированный язык <abbr title="от DEvice COmponents DEfinition">Decode</abbr> предназначен для описания интерфейсов взаимодействия с бортовой системой аппарата.

    <h2>Предметная модель языка</h2>
    <div>
        <p>Предметная модель языка это набор объектов и допустимых связей между ними из которых складывается описание интерфейсов бортовых систем.
        <p>Сущностями модели Decode являются:
            <ul>
                <li>Типы данных;
                <li>Единицы измерения;
                <li>Компоненты системы;
                <li>Бортовые параметры компонентов;
                <li>Команды компонентов;
                <li>Телеметрические сообщения компонентов.
            </ul>
        <hr/>

        <h3>Общие правила описания сущностей языка</h3>
        <div>
            <p>При определении сущности языка (типа, единицы измерения, компонента и т.д.) можно указывать текстовое описание сущности, для этого непосредственно перед конструкцией введения новой сущности следует разместить строку с описанием в одинарных или двойных кавычках.
        </div>
        <hr/>

        <h3>Пространства имен</h3>
        <div>
            <p>Пространства имен в языке служат для предотвращения коллизий имен и разделения компонентов разных разработчиков между собой.
            <p>Пространство имен должно быть указано в любом файле языка Decode первым выражением. Хорошей практикой для выбора имени пространства имен является обратная нотация домена принадлежащего компании или разработчику.
            <p>Пример указания пространства имен: <code>namespace ru.mipt.acsl</code>.
        </div>
        <hr/>

        <h3>Типы данных</h3>
        <div>
            <p>В Decode предусмотренно несколько видов типов данных, которые позволяют конструировать новые типы данных на основе существующих путем их комбинирования и расширения.
            <p>Виды типов данных в Decode:
                <ul>
                    <li>Примитивные типы;
                    <li>Встроенные типы;
                    <li>Перечисления;
                    <li>Структуры;
                    <li>Массивы;
                    <li>Подтипы;
                    <li>Обощенные типы.
                </ul>
            <p>Для задания нового типа используется выражение <code>type &lt;имя_типа&gt; &lt;определение типа&gt;</code>.
            <p>Язык поволяет определять псевдонимы для типов. Псевдоним это другое имя для того же самого типа, определение псевдонима не вводит новый тип. Для задания псевдонима типа используется выражение: <code>alias &lt;псевдоним&gt; &lt;имя_существующего_типа&gt;</code>.
            <hr/>

            <h4>Примитивные типы</h4>
            <div>
                <p>Примитивный тип это базовый тип любого простейшего неделимого значения, он состоит из вида типа и его длины в битах.
                <p>Вид типа может быть одним из:
                    <ul>
                        <li><code>int</code> &mdash; знаковое целое число (допустимая длина: 8, 16, 32 или 64 бита);
                        <li><code>uint</code> &mdash; беззнаковое целое число (допустимая длина: 8, 16, 32 или 64 бита);
                        <li><code>float</code> &mdash; действительное с плавающей точкой (допустимая длина: 32 или 64 бита);
                        <li><code>bool</code> &mdash; булево значение (допустимая длина: 8, 16, 32 или 64 бита).
                    </ul>
                <p>Примеры примитивных типов: <code>uint:32</code>, <code>bool:8</code>, <code>float:64</code>.
            </div>
            <hr/>

            <h4>Встроенные типы</h4>
            <div>
                <p>В языке определены несколько типов, которые имеют определенную стандартом реализацию, но не могут быть выражены через примитивные типы.
                <p>К таким типам относятся:
                    <ul>
                        <li><code>void</code><sup><span class="label label-warning">экспериментальное</span></sup> &mdash; пустой тип, единственным допустимым значением которого является предопределенное значение <code>void</code>. Пустой тип используется для явного указания типа в тех случаях, когда требуется явное указание типа, но допустимых значений не предусмотрено;
                        <li><code>ber</code> &mdash; формат длины <a href="https://en.wikipedia.org/wiki/X.690#BER_encoding">формата BER</a>, позволяет кодировать значение от 0 до 2<sup>128</sup>. Старший бит первого байта кодирует вид формата: если он равен 0, то оставшиеся 7 бит кодируют непосредственно значение, если он равен 1, то оставшиеся 7 бит кодируют длину значения в байтах + 1, а затем идет непосредственно само значение;
                        <li><code>or&lt;x, y&gt;</code> &mdash; обощенный тип выражающий объединение типов <code>x</code> и <code>y</code>. Для формирования значения типа требуется явное указание одного из входящих в объединение типов. Пример: <code>or&lt;float:32, uint:16&gt;</code> &mdash; значение может быть либо 32-битным действительным с плавающей точкой, либо 16-битным беззнаковым целым;
                        <li><code>optional&lt;x&gt;</code> &mdash; обобщенный тип опционального значения типа <code>x</code>. Является полным аналогом типа <code>or&lt;x, void&gt;</code> для любого x. Использование <code>void</code> в качестве аргумента типа не допускается.
                    </ul>
            </div>
            <hr/>

            <h4>Перечисления</h4>
            <div>
                <p>Перечесление это тип ограничививающий перечень возможных значений явным перечислением этих значений, а так же сопостовляющий всем допустимым значениям уникальное в рамках типа имя. Тип перечисления определяется на основе базового типа (которым может быть либо примитивный тип, либо встроенный тип <code>ber</code>).
                <p>Пример перечисления: <code>"Код возврата" type result_code enum ber (OK = 0, ERROR = 1, EXCEPTION = 2)</code>.
            </div>
            <hr/>

            <h4>Структуры</h4>
            <div>
                <p>Структура это тип состоящий из нескольких полей, каждое из которых имеет свой тип и уникальное в рамках структуры имя. Поле структуры так же может иметь строку с описанием.
                <p>Пример структуры: <code>"Структура" type point_struct struct (bool:8 isActive, uint:16 nextPoint, or&lt;float:32, int:16&gt; x)</code>,
<pre style="background-color: #2b2b2b"><span class="s0">type </span><span class="s1">node_info </span><span class="s0">struct</span><span class="s1">
(
  </span><span class="s2">'Имя узла в пределах каталога'</span><span class="s1">
  string name</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Флаг каталога'</span><span class="s1">
  b8     isDir</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Аттрибуты узла'</span><span class="s1">
  </span><span class="s0">ber    </span><span class="s1">attrs</span><span class="s3">,</span><span class="s1">
)
</pre>
            </div>
            <hr/>

            <h4>Массивы</h4>
            <div>
                <p>Массив это перечень однородных (имеющих одинаковый тип) элементов с заданными пределами количества элементов (длиной) массива. Длина массива может быть ограничена снизу, сверху, либо и снизу и сверху, в случае отсутствия ограничений сверху используется знак <code>*</code>. Массив кодируется в бинарный вид в виде длины массива и следующими за ней элементами массива. Длина массива кодируется в формате BER.
                <p>Примеры массива: <code>"Массив целых чисел" type u16_arr [uint:16]</code>, <code>"Массив флоутов" type floats [float:32, 2..8]</code>.
            </div>
            <hr/>

            <h4>Подтипы</h4>
            <div>
                <p>Подтип это новый тип созданный на основе существующего типа. Подтип может использоваться для задания ограничений на допустимые значения на основе существующего типа, а так же для разделения значений по типам с целью разграничения использования значений и защиты от неправильного использования значений (например: значение 10 может иметь тип скорости или ускорения и ограничивать применение этого значения).
                <p>Пример подтипа: <code>"Скорость" type speed uint:32</code>, <code>type arr [ber]</code>.
            </div>
            <hr/>

            <h4>Обобщенные типы</h4>
            <div>
                <p>Обобщенный тип это тип высшего порядка, параметризуемый типами. В текущей реализации Decode не предусмотрена возможность введения пользовательских обобщенных типов, допускается только использование встроенных обобщенных типов <code>or</code>, <code>optional</code>.
                    <p>При использовании обобщенного типа <code>optional</code> допускается сокращение в виде знака <code>?</code> после имени типа, то есть <code>optional&lt;error_code&gt;</code> строго соответствует <code>error_code?</code>.
            </div>

        </div>
        <hr/>

        <h3>Единицы измерения</h3>
        <div>
            <p>Decode позволяет устанавливать информационное значение единиц измерения для полей структур, параметров команд и телеметрических параметров компонентов. Использование единиц измерения позволит ввести контроль несовпадения используемых единиц измерения между различными частями бортовой системы управления и наземным комплексом управления. Единице измерения можно поставить в соответствие строковое значение определяющее отображение её в строковых применениях.
            <p>Пример определения единицы измерения: <code>"Градус" unit grad display '&deg;'</code>.
            <p>При использовании единицы измерения её имя заключается в прямые слеши и указывается непосредственно после типа. Например: <code>uint:16 /grad/</code>.
        </div>
        <hr/>

        <h3>Компоненты системы</h3>
        <div>
            <p>Компоненты это основной строительный блок интерфейсов бортовой системы. Каждый компонент определяет обособленный блок функциональности бортовой системы.
            <p>Компонент может включать:
                <ul>
                    <li>статусные телеметрические параметры &mdash; это набор полей и типов этих полей с уникальными именами в рамках компонента, статусные параметры это перечень всех бортовых параметров, которые могут составлять статусные телеметрические сообщения;
                    <li>команды &mdash; бортовые функции и процедуры реализующие определенную функциональность с восможностью параметризации их запуска;
                    <li>статусные телеметрические сообщения &mdash; неделимые сообщения от бортовой вычислительной системы состоящие из статусных параметров, которые формируются согласованно (одномоментно);
                    <li>событийные телеметрические сообщения &mdash; неделимые сообщения от бортовой вычислительной системы состоящие из кода события, статусных параметров и дополнительных параметров бортовой системы, которые формируются согласованно (одномоментно) и маркируются штампом времени формирования.
                </ul>
            <p>Компоненты системы могут включать (наследовать) друг-друга, циклическое наследование компонентов не допускается. При этом статусные и событийные сообщения наследника так же могут включать бортовые параметры определенные в наследуемом компоненте и любом из его предков.
            <p>Компоненту может быть явно установлен глобально уникальный номер, который он будет иметь в рамках любой бортовой системы, что позволит адресовать компонент без использования бортовой информации о реализованных в рамках борта компонентах. Эту возможность следует использовать с осторожностью, т.к. она мешает эволюции бортовых интерфейсов.
            <p>Компонент определяется следующим образом:
<pre style="background-color: #2b2b2b"><span class="s0">component </span><span class="s1">Comp1</span><span class="s0">:</span><span class="s4">12 </span><span class="s0">with </span><span class="s1">Comp2</span><span class="s3">, </span><span class="s1">Comp3
{
}</span></pre>
        </div>
        <hr/>

        <h3>Бортовые параметры компонентов</h3>
        <div>
            <p>Бортовой параметр это минимальная телеметрируемая в составе статусных сообщений единица информации о состоянии бортовых систем и оборудования.
            <p>Бортовые параметры повзоляют отслеживать состояние одного параметра статусной информации бортовой системы полученного в составе различных телеметрических сообщений.
            <p>Бортовые параметры определяются следующим образом:
<pre style="background-color: #2b2b2b"><span class="s0">parameters</span><span class="s1">
(
    </span><span class="s2">'Скорость'</span><span class="s1">
    </span><span class="s0">float:</span><span class="s4">32 </span><span class="s1">/mps/ speed</span><span class="s3">,</span><span class="s1">
    [</span><span class="s0">ber</span><span class="s3">, </span><span class="s4">1</span><span class="s1">..</span><span class="s4">10</span><span class="s1">]   guids</span><span class="s3">,</span><span class="s1">
)</pre>
        </div>
        <hr/>

        <h3>Команды компонентов</h3>
        <div>
            <p>Команда бортового компонента это минимальная вызываемая единица исполнения бортовой системы. Команда может быть параметризуемой, каждый параметр команды определяется с использованием типа параметра, единицы измерения (опционально) и уникального в пределах команды имени параметра. Кроме того, команда может иметь возвращаемое значение, указываемое посредством типа и единицы измерения (опционально). При отсутствии возвращаемого значения, считается, что команда возвращает <code>void</code> при успешном завершении своего исполнения.
            <p>Результат исполнения команды будет передан в обратном запуску команды направлении (от борта в наземный комплекс управления или в борт инициатор исполнения команды) по каналу с гарантированной доставкой, что обеспечивает возможность контроля за исполнением команды. Тип результата исполнения команды может быть опущен, в этом случае будет использован тип <code>void</code>. Таким образом, <code>command run()</code> строго соответствует <code>command run() -> void</code>.
            <p>Команды так же могут быть запущены бортовыми скриптами или в рамках исполнения других бортовых команд, в этом случае результат исполнения команды помещается на стек возвращаемых значений.
            <p>Команде может быть задан никальный в рамках компонента числовой идентификатор.
            <p>Пример задания команды в рамках компонента: <code>"Установить режим" command setMode:10("Номер режима" uint:16 modeNum) -> result_code?</code>.
        </div>
        <hr/>

        <h3>Телеметрические сообщения компонентов</h3>
        <div>
            <p>Телеметрическое сообщение это минимальная единица передачи информации от бортовой системы вне командного потока. Телеметрические сообщения могут быть статусными и событийными.
            <p>Статусное телеметрическое сообщение служит для периодического или управляемого режимами и командами оповещения наземного комплекса управления или другого аппарата о текущем состоянии бортовых систем и бортовой аппаратуры. Статусное сообщение может состоять только из бортовых параметров компонента или наследуемых компонентов.
            <p>Событийное сообщение служит для оповещения о наступлении определенного события с бортовой системе и помимо бортовых параметров может включать собственные параметры событийного сообщения, задаваемые типом, единицой измерения (опционально) и уникальным именем в рамках сообщения. Событийное сообщение в обязательном порядке формируется с номером события, которое ограничивается перечислимым типом для данного событийного сообщения и маркируется временем формирования сообщения.
            <p>Бортовые параметры в рамках сообщения задаются указанием имени параметра, при необходимости использования полей параметра используется разделитель <code>.</code> (точка), для указания элементов массива используются <code>[]</code> (квадратные скобки) с указанием конкретного индекса элемента массива или диапазона индексов (например: <code>[0..10]</code>). В качестве верхнего индекса позволяется указывать <code>*</code> (звездочку) как индекс конца массива. При телеметрировании массива целиком блок индексации опускается.
            <p>Бортовые параметры наследуемых компонентов указываются с использованием имени компонента, имя компонента отделяется <code>.</code> (точкой).
            <p>Задать собственные параметры событийного сообщения можно используя ключевое слово <code>var</code> и указав его тип (возможно, с указанием единиц измерения) и имя.
            <p>Пример задания статусного сообщения:
<pre style="background-color: #2b2b2b"><span class="s2">'Данные планировщика запуска скриптов'</span><span class="s1">
</span><span class="s0">status </span><span class="s1">scriptsRunTimings</span><span class="s0">:</span><span class="s4">1</span><span class="s1">
(
  scriptsRunTimings</span><span class="s3">,</span><span class="s1">
  Scripting.scripts[0].header.id</span><span class="s3">,</span><span class="s1">
)</span></pre>
            <p>Пример задания событийного сообщения:
<pre style="background-color: #2b2b2b"><span class="s2">'Режим изменен'</span><span class="s1">
</span><span class="s0">event </span><span class="s1">modeChanged</span><span class="s0">:</span><span class="s4">1</span><span class="s1"> mode_changed_events
(</span>
  <span class="s2">"Новый режим"</span> <span class="s1">mode</span><span class="s3">,</span>
  <span class="s2">"Предыдущий режим"</span> <span class="s0">var</span> <span class="s1">mode previousMode</span><span class="s3">,</span><span class="s1">
)</span></pre>
        </div>
        <hr/>

        <h3>Идентификация объектов языка</h3>
        <div>
            <p>Идентификация объекта языка разделяется на две части: идентификацию пространства имен и идентификацию объекта в пределах пространства имен.
            <p>Пространство имен однозначно идентифицируется FQN (полное имя с указанием всех родительских пространств имен разделенных точкой). Два пространства имен считаются совпадающими, если совпадают их FQN.
            <p>Внутри пространства имен объекты идентифицируются именем. В связи с тем, что пространство имен у всех объектов языка общее -- типы, компоненты, псевдонимы и др. объекты языка должны иметь уникальные имена в рамках пространства имен. Запрещается так же пересечение имен вложенных пространств имен и других объектов языка (т.к. возможно в будущем потребуется возможность ссылаться на пространство имен целиком). Объекты создаваемые косвенным методом без явного указания имени (например, структуры для параметров компонентов) получают уникальные, но недоступные для прямого использования в исходном коде имена, для чего используется специальное кодирование с использованием специальных символов.
        </div>
        <hr/>

        <p>&copy; 2015 <a href="http://acsl.mipt.ru">ЛПСУ</a>

    </div>


</div>

</div>
</body>
</html>
